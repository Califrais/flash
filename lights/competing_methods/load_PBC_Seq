defaultW <- getOption("warn")
options(warn = -1)
library("JMbayes")

preprocessing <- function(simu=False, data=NULL, time_indep_feat) {

    if (simu) {
        tmax <- 4
    }
    else {
        data(pbc2, package = "JMbayes")
        colnames <- names(pbc2)
        data <- pbc2
        data$T_long <- data$year
        data$T_survival <- data$years
        data$delta <- data$status2
        data$SGOT <- log(data$SGOT)
        data$serBilir <- log(data$serBilir)
        data$albumin <- log(data$albumin)
        tmax <- 4
    }


    # Select training and test samples
    data$id <- as.numeric(data$id)
    set.seed(2020)
    lenght_id <- length(unique(data$id))
    id_test <- sample(unique(data$id), round(lenght_id/5))

    # training dataset
    u_cols = c("id", "T_survival", "delta")
    for(i in 1:length(time_indep_feat)){
        u_cols <- append(u_cols,  time_indep_feat[[i]])
    }
    data_training <- data[which(!(data$id %in% id_test)), ]
    data_training.id <- unique(data_training[, u_cols])

    # testing dataset
    data_testing <- data[which(pbc2$id %in% id_test), ]
    data_testing.id <- unique(data_testing[, u_cols])
    return(list(data_training, data_testing, data_training.id, data_testing.id, tmax))
}